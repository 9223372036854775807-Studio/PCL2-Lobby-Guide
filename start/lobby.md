# 联机大厅创建、销毁与加入

**此页所有 API 均需要认证**

## 创建新的联机大厅


API 接口地址：

```http

POST /api/lobby/create

```
客户端应发送的数据为：

```json

{
  "name":"联机大厅名称" // 可选，若不存在或为空，服务端应随机生成名称，允许重复
  "public":false, // 大厅是否可公开访问，为 false 时只能通过大厅 uuid 加入，默认值为 false
  "username":"创建大厅使用的用户名（将会显示在大厅列表）",
  "address":"创建者的直接连接地址" // 可选，若值不存在则只能通过中继地址加入
}

```

``` json
{
  "status":201,
  "name":"联机大厅名称",
  "id":"大厅的 uuid", //无符号，由服务端随机生成，建议使用 uuidv4/uuidv7
  "access_token":"用于操作联机大厅的访问令牌，此令牌直到大厅关闭前永久有效",
  "server_address":"联机服务器自动分配的中继地址",
}

```


## 加入联机大厅

API 地址：

```http

POST /api/lobby/<大厅 uuid>/join

```

客户端应发送的数据为：

```json
{
  "username":"加入者名称", // 若重复则在名称后方加入 # + 短识别码，若仍然重复则在后方加入 - + 从 1 起递增的数字。
  "shot_identifier":"加入者的短识别码"
}
```

若访问令牌有效，服务端应返回如下响应，若无效返回错误。

```json

{
  "status":200
  "access_token":"用于本次联机的访问令牌，同样不会失效",
  "direct_address":"直接联机地址", // 若创建者没有提供或服务端禁止使用此方法则此项为 not_allowed，
  "server_address":"中继地址",
  "name":"大厅名称"
}

```

## 关闭联机大厅

API 接口

```

DELETE /api/lobby/<大厅 uuid>

```

客户端应发送的数据为：

```json
{
  "access_token":"创建者获得的访问令牌"
}
```

无需验证请求头中的令牌，若被提交的令牌不属于创建者则返回 403 响应。

::: tip

管理员可使用其管理令牌作为被提交令牌直接删除联机大厅，无需征得创建者同意。

:::

返回 204 响应。

## 离开联机大厅

API 接口地址：

```http

POST /api/lobby/<大厅 uuid>/leave

```

客户端应发送的数据为：

```json
{
  "access_token":"加入联机大厅时获得的访问令牌"
}
```

无需验证请求头中的令牌，若被提交的令牌不属于对应大厅中已签发的令牌则返回 404 响应。

返回 204 响应。

## 举报联机大厅

API 接口地址：

```http

POST /api/lobby/<大厅 uuid>/report

```

客户端应发送的数据为：

```json
{
  "reason":"举报此大厅的理由"
}
```

服务端应检查请求头中的令牌，若无效返回 401 响应，有效返回 202 响应。


